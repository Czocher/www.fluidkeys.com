<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Week 9, Fixing existing keys</title>
    <link rel="alternate" type="application/atom+xml" title="Fluidkeys Blog" href="/blog/feed.xml" />
          <meta name="description" content="Fluidkeys makes it easy to implement the best security practices and demonstrate your team's expertise with PGP. Sign up now!" />

    <link href="https://fonts.googleapis.com/css?family=Merriweather:400,900|Montserrat:500,700|Inconsolata" rel="stylesheet">
    <link href="../../stylesheets/site.css" rel="stylesheet" />
    <link href="../../stylesheets/pre-terminal.css" rel="stylesheet" />
  </head>
  <body id="">
    <header>
      <h1><a href="/">Fluidkeys</a></h1>
      <nav>
        <ul>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/weeknotes">Weeknotes</a></li>
          <li><a href="/about">About</a></li>
          <li><a href="https://download.fluidkeys.com">Download</a></li>
        </ul>
      </nav>
    </header>
        <div class="full-width">
        <section class="variable-width-container">
                <p class="date">05 October 2018</p>
    <h1>Week 9, Fixing existing keys</h1>
    <p>This week I&#39;ve been on my own, spending some quiet time with my head in the OpenPGP spec.</p>

<h2>Golang crypto/openpgp makes keys without preferences</h2>

<p>At the start of the week we realised that there&#39;s a subtle (recoverable) problem with the keys we&#39;ve been generating with Fluidkeys.</p>

<p>We use Golang&#39;s crypto/openpgp library which has a <a href="https://godoc.org/golang.org/x/crypto/openpgp#NewEntity">function for generating a key</a>. Unfortunately it seems that this function neglects to set <em>preferences</em> on the new key.</p>

<p>There are <a href="https://tools.ietf.org/html/rfc4880#section-5.2.3.7">3 types of preferences</a> (hash, symmetric key and compression) and these are there to tell other people what encryption algorithms like AES-256 you accept. The idea is you put the strongest ones first, then when the other person tries to encrypt to you, their software finds the most preferred, mutually supported algorithm.</p>

<h2>No preferences defaults to bad security</h2>

<p>Unfortunately, the OpenPGP specification says that if two implementations can&#39;t agree on an algorithm they fall back to the <strong>lowest common denominator</strong>, Triple DES and SHA1, which you <strong>must</strong> support. These are old, weak algorithms, so it&#39;s not ideal.</p>

<p>Because newly generated keys didn&#39;t have any preferences set, any messages encrypted to them were indeed using Triple DES. It wasn&#39;t straightforward to actually observe this, but once I had a sneaky suspicion it might be happening I managed to get GnuPG to spit out some debug and take a look.</p>

<h2>Our key rotation allows us to fix this</h2>

<p>The last two weeks we&#39;ve been talking about key rotation — we&#39;ve managed to get Fluidkeys automatically expiring and re-generating encryption subkeys. (Release 0.2 coming very soon, promise!)</p>

<p>Since we&#39;ve built Fluidkeys to automatically, regularly inspect the key this is the ideal mechanism for looking for poorly <em>configured</em> keys too. Alongside key rotation, we can tweak the key&#39;s configuration and generate new self-signatures.</p>

<p>So this week I&#39;ve been hard at work collating best practice to work out, what <em>is</em>the ideal configuration? And how much deviation should Fluidkeys tolerate from that?</p>

<p><a href="https://riseup.net/en/security/message-security/openpgp/best-practices">Riseup&#39;s OpenPGP best practices</a> guide came in handy as usual, and mostly I&#39;ve been encoding their rules into actual code. You can see that working in the screenshot below (the text hasn&#39;t been designed yet):</p>

<p><img src="../../images/2018-04-05-fluidkeys-key-list-with-missing-preferences.png" alt="A table of PGP keys with warnings about missing preferences" /></p>

<p>This builds on the ideas in a previous prototype I hacked up earlier in the year which allows you to <a href="https://www.expirybot.com/test-pgp-key/">test your PGP key</a>.</p>

<p>Our hunch is that it will be valuable for Fluidkeys to bring together and codify best practice — not just for individual keys, but <a href="https://www.fluidkeys.com/patterns-for-using-pgp-in-teams/">ways of using PGP together in a team</a>.</p>

<p>Next week we&#39;ll turn those warnings into actions so Fluidkeys can just fix them for you, then continue racing towards our next release 0.2...</p>

<p>Thanks for reading!</p>

<p>— Paul</p>

<p><em>All</em> feedback is welcome, pop us an email to <a href="mailto:hello@fluidkeys.com">hello@fluidkeys.com</a></p>

    <hr />
    <p><a href="/weeknotes">Back to all weeknotes</a></p>
    <h2>Subscribe to the weeknotes</h2>
    <form class="inline-button" action="https://docs.google.com/forms/d/e/1FAIpQLSeh51TXt8IdoPAHVz-ujjue3r1VPd_qoF5eV6Xf-Ww6qyF-4w/formResponse" method="post">
  <div class="input">
    <label for="email-address">Email address:</label>
    <input id="email-address" type="email" name="entry.78386960" required placeholder="">
  </div>
  <div class="button">
    <input type="submit" value="Sign up">
  </div>
</form>


        </section>
    </div>

    <footer>
      <div class="content">
        <p>
          <a href="mailto:hello@fluidkeys.com">hello@fluidkeys.com</a>
          <a href="/blog/feed.xml"><img src="../../images/rss-icon.svg" class="rss-icon" alt="Rss icon" />RSS feed</a>
        </p>
      </div>
    </footer>
    <script>
  var dnt = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
  if (dnt != "1" && dnt != "yes") {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-121440356-1', 'auto');
    ga('set', 'anonymizeIp', true);
    ga('send', 'pageview');
  } else {
    console.debug("Respecting Do-Not-Track, not loading analytics. See https://www.paulfurley.com/google-analytics-dnt/");
  }
</script>
  </body>
</html>
